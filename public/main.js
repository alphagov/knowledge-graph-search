/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/ts/event-types.ts":
/*!*******************************!*\
  !*** ./src/ts/event-types.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"EventType\": () => (/* binding */ EventType)\n/* harmony export */ });\nvar EventType;\n(function (EventType) {\n    EventType[EventType[\"Dom\"] = 0] = \"Dom\";\n    EventType[EventType[\"SearchRunning\"] = 1] = \"SearchRunning\";\n    EventType[EventType[\"SearchApiCallbackOk\"] = 2] = \"SearchApiCallbackOk\";\n    EventType[EventType[\"SearchApiCallbackFail\"] = 3] = \"SearchApiCallbackFail\";\n})(EventType || (EventType = {}));\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/event-types.ts?");

/***/ }),

/***/ "./src/ts/events.ts":
/*!**************************!*\
  !*** ./src/ts/events.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"handleEvent\": () => (/* binding */ handleEvent),\n/* harmony export */   \"searchButtonClicked\": () => (/* binding */ searchButtonClicked)\n/* harmony export */ });\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./state */ \"./src/ts/state.ts\");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils */ \"./src/ts/utils.ts\");\n/* harmony import */ var _view_view__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./view/view */ \"./src/ts/view/view.ts\");\n/* harmony import */ var _search_api__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./search-api */ \"./src/ts/search-api.ts\");\n/* harmony import */ var _event_types__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./event-types */ \"./src/ts/event-types.ts\");\n/* harmony import */ var _search_api_types__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./search-api-types */ \"./src/ts/search-api-types.ts\");\n/* harmony import */ var _lang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./lang */ \"./src/ts/lang.ts\");\n\n\n\n\n\n\n\nconst handleEvent = async function (event) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n    let fieldClicked;\n    console.log('handleEvent:', event.type, event.id || '');\n    switch (event.type) {\n        case _event_types__WEBPACK_IMPORTED_MODULE_4__.EventType.Dom:\n            switch (event.id) {\n                case 'search':\n                    // Tell GTM a search is starting\n                    (_a = window.dataLayer) === null || _a === void 0 ? void 0 : _a.push({\n                        'event': 'formSubmission',\n                        'formType': 'Search',\n                        'formPosition': 'Page'\n                    });\n                    // Update the state\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedWords = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.getFormInputValue)('keyword');\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.excludedWords = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.getFormInputValue)('excluded-keyword');\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedTaxon = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.getFormInputValue)('taxon');\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedLocale = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.getFormInputValue)('locale');\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.whereToSearch.title = (_b = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)('search-title')) === null || _b === void 0 ? void 0 : _b.checked;\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.whereToSearch.text = (_c = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)('search-text')) === null || _c === void 0 ? void 0 : _c.checked;\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.caseSensitive = (_d = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)('case-sensitive')) === null || _d === void 0 ? void 0 : _d.checked;\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.linkSearchUrl = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.getFormInputValue)('link-search');\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.skip = 0; // reset to first page\n                    if ((_e = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)('area-publisher')) === null || _e === void 0 ? void 0 : _e.checked)\n                        _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchArea.Publisher;\n                    if ((_f = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)('area-whitehall')) === null || _f === void 0 ? void 0 : _f.checked)\n                        _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchArea.Whitehall;\n                    if ((_g = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)('area-any')) === null || _g === void 0 ? void 0 : _g.checked)\n                        _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchArea.Any;\n                    if ((_h = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)('combinator-any')) === null || _h === void 0 ? void 0 : _h.checked)\n                        _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.combinator = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.Combinator.Any;\n                    if ((_j = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)('combinator-all')) === null || _j === void 0 ? void 0 : _j.checked)\n                        _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.combinator = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.Combinator.All;\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchResults = null;\n                    searchButtonClicked();\n                    break;\n                case 'button-next-page':\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.skip = _state__WEBPACK_IMPORTED_MODULE_0__.state.skip + _state__WEBPACK_IMPORTED_MODULE_0__.state.resultsPerPage;\n                    break;\n                case 'button-prev-page':\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.skip = Math.max(_state__WEBPACK_IMPORTED_MODULE_0__.state.skip - _state__WEBPACK_IMPORTED_MODULE_0__.state.resultsPerPage, 0);\n                    break;\n                case 'toggleDisamBox':\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.disamboxExpanded = !_state__WEBPACK_IMPORTED_MODULE_0__.state.disamboxExpanded;\n                    break;\n                case 'search-keyword':\n                    (0,_state__WEBPACK_IMPORTED_MODULE_0__.resetSearch)();\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Keyword;\n                    break;\n                case 'search-link':\n                    (0,_state__WEBPACK_IMPORTED_MODULE_0__.resetSearch)();\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Link;\n                    break;\n                case 'search-taxon':\n                    (0,_state__WEBPACK_IMPORTED_MODULE_0__.resetSearch)();\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Taxon;\n                    break;\n                case 'search-language':\n                    (0,_state__WEBPACK_IMPORTED_MODULE_0__.resetSearch)();\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Language;\n                    break;\n                case 'search-mixed':\n                    (0,_state__WEBPACK_IMPORTED_MODULE_0__.resetSearch)();\n                    _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType = _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Mixed;\n                    break;\n                default:\n                    fieldClicked = event.id ? event.id.match(/show-field-(.*)/) : null;\n                    if (fieldClicked && event.id) {\n                        _state__WEBPACK_IMPORTED_MODULE_0__.state.showFields[fieldClicked[1]] = (_k = (0,_utils__WEBPACK_IMPORTED_MODULE_1__.id)(event.id)) === null || _k === void 0 ? void 0 : _k.checked;\n                    }\n                    else {\n                        console.log('unknown DOM event received:', event);\n                    }\n            }\n            break;\n        // non-dom events\n        case _event_types__WEBPACK_IMPORTED_MODULE_4__.EventType.SearchRunning:\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.waiting = true;\n            break;\n        case _event_types__WEBPACK_IMPORTED_MODULE_4__.EventType.SearchApiCallbackOk:\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.searchResults = (_l = event.results) === null || _l === void 0 ? void 0 : _l.main.sort((a, b) => b.pagerank - a.pagerank);\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.metaSearchResults = (_m = event.results) === null || _m === void 0 ? void 0 : _m.meta;\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.waiting = false;\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.systemErrorText = null;\n            break;\n        case _event_types__WEBPACK_IMPORTED_MODULE_4__.EventType.SearchApiCallbackFail:\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.searchResults = null;\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.waiting = false;\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.systemErrorText = event.error;\n            console.log('search-api-callback-fail:', event.error);\n            break;\n        default:\n            console.log('unknown event type:', event);\n    }\n    updateUrl();\n    (0,_view_view__WEBPACK_IMPORTED_MODULE_2__.view)();\n    // scroll to the top of the page when paginating\n    if (event.id === 'button-next-page' || event.id === 'button-prev-page') {\n        window.scrollTo(0, 0);\n    }\n};\nconst searchButtonClicked = async function () {\n    // update the state when the user clicked Search\n    window.scrollTo(0, 0);\n    _state__WEBPACK_IMPORTED_MODULE_0__.state.systemErrorText = null;\n    _state__WEBPACK_IMPORTED_MODULE_0__.state.userErrors = [];\n    const searchStatus = (0,_state__WEBPACK_IMPORTED_MODULE_0__.searchState)();\n    switch (searchStatus.code) {\n        case 'ready-to-search':\n            if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedWords !== '' || _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedLocale !== '' || _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedTaxon !== '' || _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.linkSearchUrl !== '') {\n                _state__WEBPACK_IMPORTED_MODULE_0__.state.waiting = true;\n                (0,_search_api__WEBPACK_IMPORTED_MODULE_3__.queryGraph)(_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams, handleEvent);\n            }\n            break;\n        case 'error':\n            _state__WEBPACK_IMPORTED_MODULE_0__.state.userErrors = searchStatus.errors;\n            break;\n        case 'waiting':\n        case 'initial':\n        case 'no-results':\n        case 'results':\n            break;\n        default:\n            console.log('unknown value for searchState', (0,_state__WEBPACK_IMPORTED_MODULE_0__.searchState)());\n            break;\n    }\n};\nconst updateUrl = function () {\n    if ('URLSearchParams' in window) {\n        var searchParams = new URLSearchParams();\n        switch (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType) {\n            case _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Keyword:\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedWords !== '')\n                    searchParams.set('selected-words', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedWords);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.excludedWords !== '')\n                    searchParams.set('excluded-words', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.excludedWords);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.caseSensitive)\n                    searchParams.set('case-sensitive', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.caseSensitive.toString());\n                if (!_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.whereToSearch.title)\n                    searchParams.set('search-in-title', 'false');\n                if (!_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.whereToSearch.text)\n                    searchParams.set('search-in-text', 'false');\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch !== _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchArea.Any)\n                    searchParams.set('area', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.combinator !== _search_api_types__WEBPACK_IMPORTED_MODULE_5__.Combinator.All)\n                    searchParams.set('combinator', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.combinator);\n                break;\n            case _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Link:\n                searchParams.set('search-type', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.linkSearchUrl !== '')\n                    searchParams.set('link-search-url', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.linkSearchUrl);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch !== _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchArea.Any)\n                    searchParams.set('area', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch);\n                break;\n            case _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Taxon:\n                searchParams.set('search-type', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedTaxon !== '')\n                    searchParams.set('selected-taxon', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedTaxon);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch !== _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchArea.Any)\n                    searchParams.set('area', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch);\n                break;\n            case _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchType.Language:\n                searchParams.set('search-type', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedLocale !== '')\n                    searchParams.set('lang', (0,_lang__WEBPACK_IMPORTED_MODULE_6__.languageCode)(_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedLocale));\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch !== _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchArea.Any)\n                    searchParams.set('area', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch);\n                break;\n            default:\n                searchParams.set('search-type', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.searchType);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedWords !== '')\n                    searchParams.set('selected-words', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedWords);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.excludedWords !== '')\n                    searchParams.set('excluded-words', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.excludedWords);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedTaxon !== '')\n                    searchParams.set('selected-taxon', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedTaxon);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedLocale !== '')\n                    searchParams.set('lang', (0,_lang__WEBPACK_IMPORTED_MODULE_6__.languageCode)(_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.selectedLocale));\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.caseSensitive)\n                    searchParams.set('case-sensitive', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.caseSensitive.toString());\n                if (!_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.whereToSearch.title)\n                    searchParams.set('search-in-title', 'false');\n                if (!_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.whereToSearch.text)\n                    searchParams.set('search-in-text', 'false');\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch !== _search_api_types__WEBPACK_IMPORTED_MODULE_5__.SearchArea.Any)\n                    searchParams.set('area', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.areaToSearch);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.combinator !== _search_api_types__WEBPACK_IMPORTED_MODULE_5__.Combinator.All)\n                    searchParams.set('combinator', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.combinator);\n                if (_state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.linkSearchUrl !== '')\n                    searchParams.set('link-search-url', _state__WEBPACK_IMPORTED_MODULE_0__.state.searchParams.linkSearchUrl);\n                break;\n        }\n        const newQueryString = searchParams.toString();\n        const oldQueryString = location.search.slice(1);\n        if (newQueryString !== oldQueryString) {\n            let newRelativePathQuery = window.location.pathname;\n            if (newQueryString.length > 0) {\n                newRelativePathQuery += '?' + searchParams.toString();\n            }\n            history.pushState(null, '', newRelativePathQuery);\n        }\n    }\n};\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/events.ts?");

/***/ }),

/***/ "./src/ts/lang.ts":
/*!************************!*\
  !*** ./src/ts/lang.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"languageCode\": () => (/* binding */ languageCode),\n/* harmony export */   \"languageName\": () => (/* binding */ languageName)\n/* harmony export */ });\n// Functions to work with languages and language codes\nconst languageCode = (name) => \n// returns the language code from the language's full name\nObject.keys(languageNames).find(key => languageNames[key] === name) || name;\nconst languageName = (code) => \n// returns the language name from the language's code\nlanguageNames[code] || code;\n// IETF language codes https://en.wikipedia.org/wiki/IETF_language_tag\n// with additions\nconst languageNames = {\n    '': 'All languages',\n    'af': 'Afrikaans',\n    'am': 'Amharic',\n    'ar': 'Arabic',\n    'arn': 'Mapudungun',\n    'as': 'Assamese',\n    'az': 'Azeri',\n    'ba': 'Bashkir',\n    'be': 'Belarusian',\n    'bg': 'Bulgarian',\n    'bn': 'Bengali',\n    'bo': 'Tibetan',\n    'br': 'Breton',\n    'bs': 'Bosnian',\n    'ca': 'Catalan',\n    'co': 'Corsican',\n    'cs': 'Czech',\n    'cy': 'Welsh',\n    'da': 'Danish',\n    'de': 'German',\n    'dr': 'Dari',\n    'dsb': 'Lower Sorbian',\n    'dv': 'Divehi',\n    'el': 'Greek',\n    'en': 'English',\n    'es': 'Spanish',\n    'es-419': 'Latin-american Spanish',\n    'et': 'Estonian',\n    'eu': 'Basque',\n    'fa': 'Persian',\n    'fi': 'Finnish',\n    'fil': 'Filipino',\n    'fo': 'Faroese',\n    'fr': 'French',\n    'fy': 'Frisian',\n    'ga': 'Irish',\n    'gd': 'Scottish Gaelic',\n    'gl': 'Galician',\n    'gsw': 'Alsatian',\n    'gu': 'Gujarati',\n    'ha': 'Hausa',\n    'he': 'Hebrew',\n    'hi': 'Hindi',\n    'hr': 'Croatian',\n    'hsb': 'Upper Sorbian',\n    'hu': 'Hungarian',\n    'hy': 'Armenian',\n    'id': 'Indonesian',\n    'ig': 'Igbo',\n    'ii': 'Yi',\n    'is': 'Icelandic',\n    'it': 'Italian',\n    'iu': 'Inuktitut',\n    'ja': 'Japanese',\n    'ka': 'Georgian',\n    'kk': 'Kazakh',\n    'kl': 'Greenlandic',\n    'km': 'Khmer',\n    'kn': 'Kannada',\n    'ko': 'Korean',\n    'kok': 'Konkani',\n    'ky': 'Kyrgyz',\n    'lb': 'Luxembourgish',\n    'lo': 'Lao',\n    'lt': 'Lithuanian',\n    'lv': 'Latvian',\n    'mi': 'Maori',\n    'mk': 'Macedonian',\n    'ml': 'Malayalam',\n    'mn': 'Mongolian',\n    'moh': 'Mohawk',\n    'mr': 'Marathi',\n    'ms': 'Malay',\n    'mt': 'Maltese',\n    'my': 'Burmese',\n    'nb': 'Norwegian (BokmÃ¥l)',\n    'ne': 'Nepali',\n    'nl': 'Dutch',\n    'nn': 'Norwegian (Nynorsk)',\n    'no': 'Norwegian',\n    'nso': 'Sesotho',\n    'oc': 'Occitan',\n    'or': 'Oriya',\n    'pa': 'Punjabi',\n    'pa-pk': 'Punjabi (Pakistan)',\n    'pl': 'Polish',\n    'prs': 'Dari',\n    'ps': 'Pashto',\n    'pt': 'Portuguese',\n    'qut': 'K\\'iche',\n    'quz': 'Quechua',\n    'rm': 'Romansh',\n    'ro': 'Romanian',\n    'ru': 'Russian',\n    'rw': 'Kinyarwanda',\n    'sa': 'Sanskrit',\n    'sah': 'Yakut',\n    'se': 'Sami (Northern)',\n    'si': 'Sinhala',\n    'sk': 'Slovak',\n    'sl': 'Slovenian',\n    'sma': 'Sami (Southern)',\n    'smj': 'Sami (Lule)',\n    'smn': 'Sami (Inari)',\n    'sms': 'Sami (Skolt)',\n    'so': 'Somani',\n    'sq': 'Albanian',\n    'sr': 'Serbian',\n    'sv': 'Swedish',\n    'sw': 'Kiswahili',\n    'syr': 'Syriac',\n    'ta': 'Tamil',\n    'te': 'Telugu',\n    'tg': 'Tajik',\n    'th': 'Thai',\n    'tk': 'Turkmen',\n    'tn': 'Setswana',\n    'tr': 'Turkish',\n    'tt': 'Tatar',\n    'tzm': 'Tamazight',\n    'ug': 'Uyghur',\n    'uk': 'Ukrainian',\n    'ur': 'Urdu',\n    'uz': 'Uzbek',\n    'vi': 'Vietnamese',\n    'wo': 'Wolof',\n    'xh': 'isiXhosa',\n    'yi': 'Yiddish',\n    'yo': 'Yoruba',\n    'zh': 'Chinese',\n    'zh-hk': 'Chinese (Hong-Kong)',\n    'zh-tw': 'Chinese (Taiwan)',\n    'zu': 'isiZulu'\n};\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/lang.ts?");

/***/ }),

/***/ "./src/ts/main.ts":
/*!************************!*\
  !*** ./src/ts/main.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _view_view__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./view/view */ \"./src/ts/view/view.ts\");\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./state */ \"./src/ts/state.ts\");\n/* harmony import */ var _events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./events */ \"./src/ts/events.ts\");\n/* harmony import */ var _search_api__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./search-api */ \"./src/ts/search-api.ts\");\n\n\n\n\n//==================================================\n// INIT\n//==================================================\nconst initDatabase = async function () {\n    console.log('retrieving taxons and locales');\n    const apiResponse = await (0,_search_api__WEBPACK_IMPORTED_MODULE_3__.fetchWithTimeout)('/get-init-data');\n    if (apiResponse.taxons.length === 0 || apiResponse.locales.length === 3) {\n        throw 'Received no data from GovGraph. It might still be loading.';\n    }\n    return apiResponse;\n};\nconst init = async function () {\n    _state__WEBPACK_IMPORTED_MODULE_1__.state.systemErrorText = null;\n    try {\n        const dbInitResults = await initDatabase();\n        _state__WEBPACK_IMPORTED_MODULE_1__.state.taxons = dbInitResults.taxons;\n        _state__WEBPACK_IMPORTED_MODULE_1__.state.locales = dbInitResults.locales;\n    }\n    catch (error) {\n        if (error instanceof DOMException && error.name === \"AbortError\") {\n            _state__WEBPACK_IMPORTED_MODULE_1__.state.systemErrorText = 'It looks like GovGraph is not responding.';\n        }\n        else {\n            _state__WEBPACK_IMPORTED_MODULE_1__.state.systemErrorText = error;\n        }\n        (0,_state__WEBPACK_IMPORTED_MODULE_1__.resetSearch)();\n        return;\n    }\n    window.addEventListener('popstate', () => {\n        (0,_state__WEBPACK_IMPORTED_MODULE_1__.setQueryParamsFromQS)();\n        _state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults = null;\n        (0,_view_view__WEBPACK_IMPORTED_MODULE_0__.view)();\n        // Find if we need to run a search\n        if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedWords !== '' || _state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedLocale !== '' || _state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedTaxon !== '' || _state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.linkSearchUrl !== '') {\n            _state__WEBPACK_IMPORTED_MODULE_1__.state.waiting = true;\n            (0,_search_api__WEBPACK_IMPORTED_MODULE_3__.queryGraph)(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams, _events__WEBPACK_IMPORTED_MODULE_2__.handleEvent);\n        }\n    });\n};\n//==================================================\n// START\n//==================================================\n(async () => {\n    await init();\n    if (!_state__WEBPACK_IMPORTED_MODULE_1__.state.systemErrorText) {\n        (0,_state__WEBPACK_IMPORTED_MODULE_1__.setQueryParamsFromQS)();\n        (0,_view_view__WEBPACK_IMPORTED_MODULE_0__.view)();\n        // the above is needed to set the form input values from the state in case it\n        // was modified by the query string\n        (0,_events__WEBPACK_IMPORTED_MODULE_2__.searchButtonClicked)();\n    }\n    (0,_view_view__WEBPACK_IMPORTED_MODULE_0__.view)();\n})();\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/main.ts?");

/***/ }),

/***/ "./src/ts/search-api-types.ts":
/*!************************************!*\
  !*** ./src/ts/search-api-types.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Combinator\": () => (/* binding */ Combinator),\n/* harmony export */   \"MetaResultType\": () => (/* binding */ MetaResultType),\n/* harmony export */   \"SearchArea\": () => (/* binding */ SearchArea),\n/* harmony export */   \"SearchType\": () => (/* binding */ SearchType)\n/* harmony export */ });\nvar SearchType;\n(function (SearchType) {\n    SearchType[\"Keyword\"] = \"keyword\";\n    SearchType[\"Link\"] = \"link\";\n    SearchType[\"Taxon\"] = \"taxon\";\n    SearchType[\"Language\"] = \"language\";\n    SearchType[\"Mixed\"] = \"mixed\";\n    SearchType[\"Results\"] = \"results\";\n})(SearchType || (SearchType = {}));\n;\nvar Combinator;\n(function (Combinator) {\n    Combinator[\"Any\"] = \"any\";\n    Combinator[\"All\"] = \"all\";\n    Combinator[\"NotSet\"] = \"notset\";\n})(Combinator || (Combinator = {}));\nvar SearchArea;\n(function (SearchArea) {\n    SearchArea[\"Any\"] = \"any\";\n    SearchArea[\"Whitehall\"] = \"whitehall\";\n    SearchArea[\"Publisher\"] = \"publisher\";\n})(SearchArea || (SearchArea = {}));\nvar MetaResultType;\n(function (MetaResultType) {\n    //  Person = \"Person\",\n    MetaResultType[\"Organisation\"] = \"Organisation\";\n    MetaResultType[\"BankHoliday\"] = \"BankHoliday\";\n    //  Role = \"Role\",\n    MetaResultType[\"Taxon\"] = \"Taxon\";\n    MetaResultType[\"Transaction\"] = \"Transaction\";\n})(MetaResultType || (MetaResultType = {}));\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/search-api-types.ts?");

/***/ }),

/***/ "./src/ts/search-api.ts":
/*!******************************!*\
  !*** ./src/ts/search-api.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"fetchWithTimeout\": () => (/* binding */ fetchWithTimeout),\n/* harmony export */   \"makeQueryString\": () => (/* binding */ makeQueryString),\n/* harmony export */   \"queryGraph\": () => (/* binding */ queryGraph)\n/* harmony export */ });\n/* harmony import */ var _search_api_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./search-api-types */ \"./src/ts/search-api-types.ts\");\n/* harmony import */ var _lang__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lang */ \"./src/ts/lang.ts\");\n/* harmony import */ var _event_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./event-types */ \"./src/ts/event-types.ts\");\n\n\n\nconst makeQueryString = function (sp) {\n    const usp = new URLSearchParams();\n    if (sp.searchType !== _search_api_types__WEBPACK_IMPORTED_MODULE_0__.SearchType.Keyword)\n        usp.set('search-type', sp.searchType);\n    if (sp.selectedWords !== '')\n        usp.set('selected-words', sp.selectedWords);\n    if (sp.excludedWords !== '')\n        usp.set('excluded-words', sp.excludedWords);\n    if (sp.selectedTaxon !== '')\n        usp.set('selected-taxon', sp.selectedTaxon);\n    if (sp.selectedLocale !== '')\n        usp.set('lang', (0,_lang__WEBPACK_IMPORTED_MODULE_1__.languageCode)(sp.selectedLocale));\n    if (sp.caseSensitive)\n        usp.set('case-sensitive', sp.caseSensitive.toString());\n    if (!sp.whereToSearch.title)\n        usp.set('search-in-title', 'false');\n    if (!sp.whereToSearch.text)\n        usp.set('search-in-text', 'false');\n    if (sp.areaToSearch !== _search_api_types__WEBPACK_IMPORTED_MODULE_0__.SearchArea.Any)\n        usp.set('area', sp.areaToSearch);\n    if (sp.combinator !== _search_api_types__WEBPACK_IMPORTED_MODULE_0__.Combinator.All)\n        usp.set('combinator', sp.combinator);\n    if (sp.linkSearchUrl !== '')\n        usp.set('link-search-url', sp.linkSearchUrl);\n    return usp.toString();\n};\nconst fetchWithTimeout = async function (url, timeoutSeconds = 60) {\n    const controller = new AbortController();\n    setTimeout(() => controller.abort(), timeoutSeconds * 1000);\n    const fetchResult = await fetch(url, {\n        method: 'GET',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        signal: controller.signal\n    });\n    const responseBody = await fetchResult.json();\n    if (!fetchResult.ok) {\n        if (/^timeout of \\d+ms exceeded/.test(responseBody.message)) {\n            throw 'TIMEOUT';\n        }\n        else {\n            throw 'UNKNOWN';\n        }\n    }\n    else {\n        return responseBody;\n    }\n};\n// called from browser\nconst queryGraph = async function (searchParams, callback) {\n    callback({ type: _event_types__WEBPACK_IMPORTED_MODULE_2__.EventType.SearchRunning });\n    const url = `/search?${makeQueryString(searchParams)}`;\n    let apiResults;\n    try {\n        apiResults = await fetchWithTimeout(url, 300);\n    }\n    catch (error) {\n        console.log('error running main+meta queries', error);\n        callback({ type: _event_types__WEBPACK_IMPORTED_MODULE_2__.EventType.SearchApiCallbackFail, error });\n        return;\n    }\n    let { mainResults, metaResults } = apiResults;\n    // If there's an exact match within the meta results, just keep that one\n    const searchKeywords = searchParams.selectedWords.replace(/\"/g, '');\n    const exactMetaResults = metaResults.filter((result) => {\n        return result.name.toLowerCase() === searchKeywords.toLowerCase();\n    });\n    if (exactMetaResults.length === 1) {\n        metaResults = exactMetaResults;\n    }\n    if (metaResults.length === 1) {\n        // one meta result: show the knowledge panel (may require more API queries)\n        const fullMetaResults = await buildMetaboxInfo(metaResults[0]);\n        callback({ type: _event_types__WEBPACK_IMPORTED_MODULE_2__.EventType.SearchApiCallbackOk, results: { main: mainResults, meta: [fullMetaResults] } });\n        // } else if (metaResults.length >= 1) {\n        //   // multiple meta results: we'll show a disambiguation page\n        //   callback({ type: EventType.SearchApiCallbackOk, results: { main: mainResults, meta: metaResults } });\n    }\n    else {\n        // no meta results\n        callback({ type: _event_types__WEBPACK_IMPORTED_MODULE_2__.EventType.SearchApiCallbackOk, results: { main: mainResults, meta: null } });\n    }\n};\n//=========== private ===========\nconst buildMetaboxInfo = async function (info) {\n    console.log(`Found a ${info.type}. Running extra queries`);\n    console.log(info);\n    switch (info.type) {\n        case 'BankHoliday': {\n            return await fetchWithTimeout(`/bank-holiday?name=${encodeURIComponent(info.name)}`);\n        }\n        // case 'Person': {\n        //   return await fetchWithTimeout(`/person?name=${encodeURIComponent(info.name)}`);\n        // }\n        // case 'Role': {\n        //   return await fetchWithTimeout(`/role?name=${encodeURIComponent(info.name)}`);\n        // }\n        case 'Organisation': {\n            return await fetchWithTimeout(`/organisation?name=${encodeURIComponent(info.name)}`);\n        }\n        case 'Transaction': {\n            return await fetchWithTimeout(`/transaction?name=${encodeURIComponent(info.name)}`);\n        }\n        case 'Taxon': {\n            return await fetchWithTimeout(`/taxon?name=${encodeURIComponent(info.name)}`);\n        }\n        default:\n            console.log('unknown meta node type', info.type);\n    }\n};\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/search-api.ts?");

/***/ }),

/***/ "./src/ts/state.ts":
/*!*************************!*\
  !*** ./src/ts/state.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"resetSearch\": () => (/* binding */ resetSearch),\n/* harmony export */   \"searchState\": () => (/* binding */ searchState),\n/* harmony export */   \"setQueryParamsFromQS\": () => (/* binding */ setQueryParamsFromQS),\n/* harmony export */   \"state\": () => (/* binding */ state)\n/* harmony export */ });\n/* harmony import */ var _lang__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lang */ \"./src/ts/lang.ts\");\n/* harmony import */ var _search_api_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./search-api-types */ \"./src/ts/search-api-types.ts\");\n\n\n// user inputs that are used to build the query.\n// (basically, everything whose value could be found in the URL)\n// Separate from (but included in)  state to make\n// it easier to reset to those initial\n// values only while keeping the rest of the state\nconst initialSearchParams = {\n    searchType: _search_api_types__WEBPACK_IMPORTED_MODULE_1__.SearchType.Keyword,\n    selectedWords: '',\n    excludedWords: '',\n    selectedTaxon: '',\n    selectedLocale: '',\n    linkSearchUrl: '',\n    whereToSearch: {\n        title: true,\n        text: true // whether search should include page content\n    },\n    combinator: _search_api_types__WEBPACK_IMPORTED_MODULE_1__.Combinator.All,\n    areaToSearch: _search_api_types__WEBPACK_IMPORTED_MODULE_1__.SearchArea.Any,\n    caseSensitive: false // whether the keyword search is case sensitive\n};\nconst state = {\n    searchParams: JSON.parse(JSON.stringify(initialSearchParams)),\n    taxons: [],\n    locales: [],\n    systemErrorText: null,\n    userErrors: [],\n    searchResults: null,\n    metaSearchResults: null,\n    skip: 0,\n    resultsPerPage: 10,\n    showFields: {\n        url: true,\n        title: true\n    },\n    waiting: false,\n    disamboxExpanded: false // if there's a resizeable disamb meta box, whether it's expanded or not\n};\nconst setQueryParamsFromQS = function () {\n    const searchParams = new URLSearchParams(window.location.search);\n    const maybeReplace = (stateField, qspName) => searchParams.get(qspName) !== null ? searchParams.get(qspName) : initialSearchParams[stateField];\n    state.searchParams.searchType = maybeReplace('searchType', 'search-type');\n    state.searchParams.selectedWords = maybeReplace('selectedWords', 'selected-words');\n    state.searchParams.excludedWords = maybeReplace('excludedWords', 'excluded-words');\n    state.searchParams.linkSearchUrl = maybeReplace('linkSearchUrl', 'link-search-url');\n    state.searchParams.selectedTaxon = maybeReplace('selectedTaxon', 'selected-taxon');\n    const lang = searchParams.get('lang');\n    state.searchParams.selectedLocale = lang ? (0,_lang__WEBPACK_IMPORTED_MODULE_0__.languageName)(lang) : initialSearchParams.selectedLocale;\n    state.searchParams.caseSensitive = maybeReplace('caseSensitive', 'case-sensitive');\n    state.searchParams.areaToSearch = maybeReplace('areaToSearch', 'area');\n    state.searchParams.combinator = maybeReplace('combinator', 'combinator');\n    state.searchParams.whereToSearch.title = searchParams.get('search-in-title') === 'false' ?\n        false : initialSearchParams.whereToSearch.title;\n    state.searchParams.whereToSearch.text = searchParams.get('search-in-text') === 'false' ?\n        false : initialSearchParams.whereToSearch.text;\n};\nconst searchState = function () {\n    // Find out what to display depending on state\n    // returns an object with a \"code\" field\n    // \"no-results\": there was a search but no results were returned\n    // \"results\": there was a search and there are results to display\n    // \"initial\": there weren't any search criteria specified\n    // \"errors\": the user didn't specify a valid query. In this case\n    //   we add a \"errors\" field containing an array with values among:\n    //   - \"missingWhereToSearch\": keywords were specified but not where to look for them on pages\n    // \"waiting\": there's a query running\n    const errors = [];\n    if (state.waiting)\n        return { code: 'waiting', errors };\n    if (state.searchParams.selectedWords === '' && state.searchParams.excludedWords === '' && state.searchParams.selectedTaxon === '' && state.searchParams.selectedLocale === '' && state.searchParams.linkSearchUrl === '' && state.searchParams.whereToSearch.title === false && state.searchParams.whereToSearch.text === false) {\n        return { code: 'initial', errors };\n    }\n    if (state.searchParams.selectedWords !== '') {\n        if (!state.searchParams.whereToSearch.title && !state.searchParams.whereToSearch.text) {\n            errors.push('missingWhereToSearch');\n        }\n    }\n    if (errors.length > 0)\n        return { code: 'error', errors };\n    if (state.searchResults && state.searchResults.length > 0)\n        return { code: 'results', errors };\n    if (state.searchResults && state.searchResults.length === 0)\n        return { code: 'no-results', errors };\n    return { code: 'ready-to-search', errors };\n};\nconst resetSearch = function () {\n    state.searchParams.selectedWords = '';\n    state.searchParams.excludedWords = '';\n    state.searchParams.selectedTaxon = '';\n    state.searchParams.selectedLocale = '';\n    state.searchParams.whereToSearch.title = true;\n    state.searchParams.whereToSearch.text = true;\n    state.searchParams.caseSensitive = false;\n    state.searchParams.linkSearchUrl = '';\n    state.skip = 0; // reset to first page\n    state.searchParams.areaToSearch = _search_api_types__WEBPACK_IMPORTED_MODULE_1__.SearchArea.Any;\n    state.searchResults = null;\n    state.waiting = false;\n    state.searchParams.combinator = _search_api_types__WEBPACK_IMPORTED_MODULE_1__.Combinator.All;\n};\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/state.ts?");

/***/ }),

/***/ "./src/ts/utils.ts":
/*!*************************!*\
  !*** ./src/ts/utils.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"getFormInputValue\": () => (/* binding */ getFormInputValue),\n/* harmony export */   \"id\": () => (/* binding */ id),\n/* harmony export */   \"sanitiseInput\": () => (/* binding */ sanitiseInput),\n/* harmony export */   \"sanitiseOutput\": () => (/* binding */ sanitiseOutput),\n/* harmony export */   \"splitKeywords\": () => (/* binding */ splitKeywords)\n/* harmony export */ });\nconst id = (x) => document.getElementById(x);\nconst tagBody = '(?:[^\"\\'>]|\"[^\"]*\"|\\'[^\\']*\\')*';\nconst tagOrComment = new RegExp('<(?:'\n    // Comment body.\n    + '!--(?:(?:-*[^->])*--+|-?)'\n    // Special \"raw text\" elements whose content should be elided.\n    + '|script\\\\b' + tagBody + '>[\\\\s\\\\S]*?</script\\\\s*'\n    + '|style\\\\b' + tagBody + '>[\\\\s\\\\S]*?</style\\\\s*'\n    // Regular name\n    + '|/?[a-z]'\n    + tagBody\n    + ')>', 'gi');\nconst getFormInputValue = (inputId) => { var _a; return sanitiseInput((_a = id(inputId)) === null || _a === void 0 ? void 0 : _a.value); };\nconst sanitiseInput = function (text) {\n    // remove text that could lead to script injections\n    if (!text)\n        return '';\n    let oldText;\n    do {\n        oldText = text;\n        text = text.replace(tagOrComment, '');\n    } while (text !== oldText);\n    return text.replace(/</g, '&lt;').replace(/\"\"*/g, '\"');\n};\nconst sanitiseOutput = function (text) {\n    const escapeHTML = (str) => new Option(str).innerHTML;\n    return escapeHTML(text)\n        .replace(/'/g, '&apos;')\n        .replace(/\"/g, '&quot;');\n};\nconst splitKeywords = function (keywords) {\n    const wordsToIgnore = ['of', 'for', 'the', 'or', 'and'];\n    const regexp = /[^\\s,\"]+|\"([^\"]*)\"/gi;\n    const output = [];\n    let match;\n    do {\n        match = regexp.exec(keywords);\n        if (match) {\n            output.push(match[1] ? match[1] : match[0]);\n        }\n    } while (match);\n    return output.filter(d => d.length > 0 && !wordsToIgnore.includes(d));\n};\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/utils.ts?");

/***/ }),

/***/ "./src/ts/view/view-components.ts":
/*!****************************************!*\
  !*** ./src/ts/view/view-components.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"viewMetaLink\": () => (/* binding */ viewMetaLink)\n/* harmony export */ });\nconst viewMetaLink = (text, extraClasses = '') => `<a class=\"govuk-link ${extraClasses}\" href=\"/?selected-words=${encodeURIComponent(`\"${text}\"`)}\">${text}</a>`;\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/view/view-components.ts?");

/***/ }),

/***/ "./src/ts/view/view-metabox.ts":
/*!*************************************!*\
  !*** ./src/ts/view/view-metabox.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"viewMetaResults\": () => (/* binding */ viewMetaResults)\n/* harmony export */ });\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../state */ \"./src/ts/state.ts\");\n/* harmony import */ var _view_components__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./view-components */ \"./src/ts/view/view-components.ts\");\n\n\nconst viewDetails = (title, list, itemFormatFn) => {\n    if (list.length === 0)\n        return '';\n    return `\n    <details class=\"govuk-details\">\n      <summary class=\"govuk-details__summary\">\n        <span class=\"govuk-details__summary-text\">\n          ${title}\n        </span>\n      </summary>\n      <div class=\"govuk-details__text\">\n        <ul class=\"govuk-list govuk-list--bullet\">\n          ${list.map(item => `<li>${itemFormatFn(item)}</li>`).join('')}\n        </ul>\n      </div>\n    </details>\n  `;\n};\nconst viewOrgPersonRoles = (personRoles) => viewDetails(`${personRoles.length} ${personRoles.length === 1 ? 'person' : 'people'}`, sortedBy(personRoles, 'personName'), personRole => `${(0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(personRole.personName)} (${(0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(personRole.roleName)})`);\nconst viewOrgChildren = (childOrgNames) => viewDetails(`${childOrgNames.length} sub-organisations`, childOrgNames.sort(), _view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink);\nconst viewPersonRoles = function (roles) {\n    const title = roles.length === 1 ? 'Role' : 'Roles';\n    const roleFormatter = role => `\n    ${(0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(role.title)} ${role.orgName ? ' at ' + (0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(role.orgName) : ''}\n    (${role.startDate ? new Date(role.startDate).getFullYear() : ''}\n    to ${role.endDate ? new Date(role.endDate).getFullYear() : 'present'})`;\n    const rolesInDateOrder = sortedBy(roles, 'startDate').reverse();\n    return viewDetails(title, rolesInDateOrder, roleFormatter);\n};\nconst viewRolePersons = (persons) => {\n    const formatPerson = (person) => {\n        return `\n    ${(0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(person.name)}\n    (${person.startDate ? new Date(person.startDate).getFullYear() : ''}\n    to\n    ${person.endDate ? new Date(person.endDate).getFullYear() : 'now'})\n  `;\n    };\n    const currents = persons.filter((person) => person.endDate === null);\n    const previous = persons.filter((person) => person.endDate !== null);\n    const currentsHtml = currents.length === 0 ?\n        '<p class=\"govuk-body-l\">No current holder</p>' :\n        (currents.length === 1 ?\n            `<p class=\"govuk-body\">Current holder:</p>\n       <p class=\"govuk-body-l\"><a href=\"${currents[0].homepage}\">${currents[0].name}</a></p>\n       <p class=\"govuk-body\">(since ${new Date(currents[0].startDate).getFullYear()})</p>\n        ` :\n            `<ul class=\"govuk-list govuk-list--bullet\" >\n    ${currents.sort((a, b) => new Date(b.startDate).getTime() - new Date(a.startDate).getTime()).map(person => `<li>${formatPerson(person)}</li>`).join('')}\n  </ul>\n    `);\n    const previousHtml = previous.length === 0 ?\n        '<p class=\"govuk-body\">No previous holders</p>' :\n        (previous.length === 1 ? `\n    <p class=\"govuk-body\" > Previous holder: ${formatPerson(previous[0])} </p>` : `\n    <details class=\"govuk-details\" >\n      <summary class=\"govuk-details__summary\" >\n        <span class=\"govuk-details__summary-text\" >\n          Previous holders\n        </span>\n      </summary>\n      <div class=\"govuk-details__text\" >\n        <ul class=\"govuk-list govuk-list--bullet\" >\n          ${previous.sort((a, b) => new Date(b.startDate).getTime() - new Date(a.startDate).getTime()).map(person => `<li>${formatPerson(person)}</li>`).join('')}\n        </ul>\n      </div>\n    </details>\n  `);\n    return `${currentsHtml} ${previousHtml} `;\n};\nconst viewBankHolidayDetails = function (holiday) {\n    const datesDetails = viewDetails('dates', holiday.dates.sort().reverse(), date => date);\n    const regionDetails = viewDetails('Observed in', holiday.regions.sort(), region => region);\n    return `${datesDetails}${regionDetails} `;\n};\nconst viewBankHoliday = (record) => `<div class=\"meta-results-panel\" >\n    <h2 class=\"govuk-heading-m\" >\n      ${record.name}\n  </h2>\n    <p class=\"govuk-body\" > Bank holiday </p>\n     ${viewBankHolidayDetails(record)}\n  </div>\n    `;\nconst viewPerson = (record) => `<div class=\"meta-results-panel\" >\n    <h2 class=\"govuk-heading-m\" >\n      <a class=\"govuk-link\" href=\"${record.homepage}\" > ${record.name} </a>\n        </h2>\n        <p class=\"govuk-body\" > ${record.description} </p>\n     ${record.roles && record.roles.length > 0 ? viewPersonRoles(record.roles) : ''}\n  </div>`;\nconst viewRoleOrgs = (orgs) => viewDetails(`belongs to ${orgs.length} ${orgs.length === 1 ? 'organisation' : 'organisations'}`, orgs.sort(), _view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink);\n/*\nconst viewRolePersons = (persons: any[]) =>\n  viewDetails(\n    `${persons.length} ${persons.length === 1 ? 'person' : 'people'}`,\n    persons,\n    viewMetaLink\n  );\n*/\nconst viewRole = function (record) {\n    const nameHtml = record.homePage ?\n        `<a class=\"govuk-link\" href=\"${record.homepage}\">${record.name}</a>` :\n        record.name;\n    return `\n    <div class=\"meta-results-panel\">\n      <h2 class=\"govuk-heading-m\">${nameHtml}</h2>\n      <p class=\"govuk-body\">Official role</p>\n      ${record.description ? `<p class=\"govuk-body\">${record.description}</p>` : ''}\n      ${viewRoleOrgs(record.orgNames)}\n      ${viewRolePersons(record.personNames)}\n    </div>`;\n};\nconst viewOrg = (record) => `\n  <div class=\"meta-results-panel\">\n    <h2 class=\"govuk-heading-m\">\n      <a class=\"govuk-link\" href=\"${record.homepage}\">${record.name}</a>\n    </h2>\n    <p class=\"govuk-body\">\n      Government organisation${record.parentName ? `, part of ${(0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(record.parentName)}` : ''}\n    </p>\n    ${record.supersededBy.length > 0 ? `\n      <p class=\"govuk-body govuk-!-font-weight-bold\">\n        ${viewMetaLinkList(record.supersededBy, 'Superseded by:')}\n      </p>\n    ` : ''}\n    ${record.description ? `<p class=\"govuk-body\">${record.description}</p>` : ''}\n    ${record.childOrgNames && record.childOrgNames.length > 0 ?\n    viewOrgChildren(record.childOrgNames) : ''}\n    ${record.personRoleNames && record.personRoleNames.length > 0 ?\n    viewOrgPersonRoles(record.personRoleNames) : ''}\n    ${record.supersedes.length > 0 ? `\n    <p class=\"govuk-body\">${viewMetaLinkList(record.supersedes, 'Supersedes: ')}</p>\n    ` : ''}\n  </div>\n`;\nconst viewMetaLinkList = (names, title, noneTitle) => {\n    if (names.length === 0 && noneTitle) {\n        return noneTitle;\n    }\n    else if (names.length === 1) {\n        return `\n      ${(title === null || title === void 0 ? void 0 : title.length) > 0 ? title : ''}\n      ${(0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(names[0])}\n    `;\n    }\n    else {\n        return `\n      ${(title === null || title === void 0 ? void 0 : title.length) > 0 ? title : ''}\n      <ul class=\"govuk-list govuk-list--bullet\">\n        ${names.map(name => `<li>${(0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(name)}</li>`).join('')}\n      </ul>\n    `;\n    }\n};\nconst viewTransaction = (record) => `<div class=\"meta-results-panel\">\n     <h2 class=\"govuk-heading-m\">\n       <a class=\"govuk-link\" href=\"${record.homepage}\">${record.name}</a>\n     </h2>\n     <p class=\"govuk-body\">Online government service</p>\n     ${record.description ? `<p class=\"govuk-body\">${record.description}</p>` : ''}\n   </div>\n  `;\nconst viewTaxon = (record) => {\n    var _a;\n    return `<div class=\"meta-results-panel\">\n     ${viewTaxonAncestors(record.ancestorTaxons)}\n     <h2 class=\"govuk-heading-m\">\n       <a class=\"govuk-link\" href=\"${record.homepage}\">${record.name}</a>\n     </h2>\n     <p class=\"govuk-body\">GOV.UK Taxon</p>\n     ${record.description ? `<p class=\"govuk-body\">${record.description}</p>` : ''}\n     ${((_a = record.childTaxons) === null || _a === void 0 ? void 0 : _a.length) ? viewTaxonChildren(record.childTaxons) : ''}\n   </div>\n  `;\n};\nconst viewTaxonAncestors = (ancestors) => (ancestors === null || ancestors === void 0 ? void 0 : ancestors.length) > 0 ? `\n    <div class=\"govuk-breadcrumbs\">\n      <ol class=\"govuk-breadcrumbs__list\">\n        ${sortedBy(ancestors, 'level').map(taxon => `\n        <li class=\"govuk-breadcrumbs__list-item\">\n          ${(0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(taxon.name, 'govuk-breadcrumbs__link')}\n        </li>\n        `)}\n      </ol>\n    </div>\n  ` : '';\nconst viewTaxonChildren = (records) => {\n    return viewDetails('Subtaxons', sortedBy(records, 'name'), taxon => (0,_view_components__WEBPACK_IMPORTED_MODULE_1__.viewMetaLink)(taxon.name));\n};\n// Sorts a list of object using a specific field to sort by\nconst sortedBy = function (arrayOfObjects, field) {\n    const deepCopy = JSON.parse(JSON.stringify(arrayOfObjects));\n    return deepCopy.sort((a, b) => a[field] < b[field] ? -1 : 1);\n};\n//=================== public ====================\nconst viewMetaResultsExpandToggle = () => _state__WEBPACK_IMPORTED_MODULE_0__.state.metaSearchResults && _state__WEBPACK_IMPORTED_MODULE_0__.state.metaSearchResults.length > 5 ?\n    `< button id = \"meta-results-expand\" > ${_state__WEBPACK_IMPORTED_MODULE_0__.state.disamboxExpanded ? 'show less' : 'show more'} < /button>` :\n    '';\nconst viewMetaResults = function () {\n    if (!_state__WEBPACK_IMPORTED_MODULE_0__.state.metaSearchResults)\n        return;\n    //  if (state.metaSearchResults.length > 1) {\n    //    const expandedClass = state.metaSearchResults.length > 5 && !state.disamboxExpanded ? 'meta-results-panel--collapsed' : '';\n    //    return `\n    //      <div class=\"meta-results-panel\">\n    //        <div class=\"meta-results-panel__collapsible ${expandedClass}\">\n    //          <h2 class=\"govuk-heading-s\">\"${state.selectedWords.replace(/\"/g, '')}\" can refer to:</h2>\n    //          <ul class=\"govuk-list govuk-list--bullet\">\n    //            ${state.metaSearchResults.map(result => `<li>${viewMetaLink(result.name)}: (${result.type.toLowerCase()})</li>`).join('')}\n    //          </ul>\n    //        </div>\n    //        ${viewMetaResultsExpandToggle()}\n    //      </div>\n    //    `;\n    //  } else {\n    const record = _state__WEBPACK_IMPORTED_MODULE_0__.state.metaSearchResults[0];\n    console.log(`meta: found a ${record.type}`);\n    console.log(record);\n    switch (record.type) {\n        case 'BankHoliday': return viewBankHoliday(record);\n        case 'Organisation': return viewOrg(record);\n        case 'Person': return viewPerson(record);\n        case 'Role': return viewRole(record);\n        case 'Transaction': return viewTransaction(record);\n        case 'Taxon': return viewTaxon(record);\n        default:\n            console.log(`unknown record type: ${record.type}`);\n            return ``;\n    }\n    //}\n};\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/view/view-metabox.ts?");

/***/ }),

/***/ "./src/ts/view/view-search-panel.ts":
/*!******************************************!*\
  !*** ./src/ts/view/view-search-panel.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"viewSearchPanel\": () => (/* binding */ viewSearchPanel)\n/* harmony export */ });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils */ \"./src/ts/utils.ts\");\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../state */ \"./src/ts/state.ts\");\n/* harmony import */ var _lang__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lang */ \"./src/ts/lang.ts\");\n/* harmony import */ var _search_api_types__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../search-api-types */ \"./src/ts/search-api-types.ts\");\n\n\n\n\nconst viewSearchPanel = () => {\n    const result = [];\n    switch (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.searchType) {\n        case _search_api_types__WEBPACK_IMPORTED_MODULE_3__.SearchType.Mixed:\n        case _search_api_types__WEBPACK_IMPORTED_MODULE_3__.SearchType.Results:\n            result.push(`\n      <form id=\"search-form\" class=\"search-panel govuk-form\">\n        <div class=\"search-mode-panel\">\n          <h1 class=\"govuk-heading-xl\">Mixed search</h1>\n          ${viewKeywordsInput()}\n          ${viewKeywordsCombinator()}\n          ${viewExclusionsInput()}\n          ${viewCaseSensitiveSelector()}\n          ${viewScopeSelector()}\n          ${viewLinkSearch()}\n          ${viewPublishingAppSelector()}\n          ${viewTaxonSelector()}\n          ${viewLocaleSelector()}\n          ${viewSearchButton()}\n        </div>\n      </form>\n    `);\n            break;\n        case _search_api_types__WEBPACK_IMPORTED_MODULE_3__.SearchType.Keyword:\n            result.push(`\n      <form id=\"search-form\" class=\"search-panel govuk-form\">\n        <div class=\"search-mode-panel\">\n          <a class=\"govuk-skip-link\" href=\"#results-table\">Skip to results</a>\n          ${viewKeywordsInput()}\n          <details class=\"govuk-details\" data-module=\"govuk-details\">\n            <summary class=\"govuk-details__summary\">\n              <span class=\"govuk-details__summary-text\">\n                Filters\n              </span>\n            </summary>\n            <div class=\"govuk-details__text\">\n              ${viewKeywordsCombinator()}\n              ${viewExclusionsInput()}\n              ${viewCaseSensitiveSelector()}\n              ${viewScopeSelector()}\n              ${viewPublishingAppSelector()}\n            </div>\n          </details>\n          ${viewSearchButton()}\n        </div>\n      </form>\n    `);\n            break;\n        case _search_api_types__WEBPACK_IMPORTED_MODULE_3__.SearchType.Link:\n            result.push(`\n      <form id=\"search-form\" class=\"search-panel govuk-form\">\n        <div class=\"search-mode-panel\">\n          <a class=\"govuk-skip-link\" href=\"#results-table\">Skip to results</a>\n          ${viewLinkSearch()}\n          <details class=\"govuk-details\" data-module=\"govuk-details\">\n            <summary class=\"govuk-details__summary\">\n              <span class=\"govuk-details__summary-text\">\n                Filters\n              </span>\n            </summary>\n            <div class=\"govuk-details__text\">\n              ${viewPublishingAppSelector()}\n            </div>\n          </details>\n          ${viewSearchButton()}\n        </div>\n      </form>\n    `);\n            break;\n        case _search_api_types__WEBPACK_IMPORTED_MODULE_3__.SearchType.Taxon:\n            result.push(`\n      <form id=\"search-form\" class=\"search-panel govuk-form\">\n        <div class=\"search-mode-panel\">\n          <a class=\"govuk-skip-link\" href=\"#results-table\">Skip to results</a>\n          ${viewTaxonSelector()}\n          <details class=\"govuk-details\" data-module=\"govuk-details\">\n            <summary class=\"govuk-details__summary\">\n              <span class=\"govuk-details__summary-text\">\n                Filters\n              </span>\n            </summary>\n            <div class=\"govuk-details__text\">\n              ${viewPublishingAppSelector()}\n            </div>\n          </details>\n          ${viewSearchButton()}\n        </div>\n      </form>\n    `);\n            break;\n        case _search_api_types__WEBPACK_IMPORTED_MODULE_3__.SearchType.Language:\n            result.push(`\n      <form id=\"search-form\" class=\"search-panel govuk-form\">\n        <div class=\"search-mode-panel\">\n          <a class=\"govuk-skip-link\" href=\"#results-table\">Skip to results</a>\n          ${viewLocaleSelector()}\n          <details class=\"govuk-details\" data-module=\"govuk-details\">\n            <summary class=\"govuk-details__summary\">\n              <span class=\"govuk-details__summary-text\">\n                Filters\n              </span>\n            </summary>\n            <div class=\"govuk-details__text\">\n              ${viewPublishingAppSelector()}\n            </div>\n          </details>\n          ${viewSearchButton()}\n        </div>\n      </form>\n    `);\n            break;\n        default:\n            console.log('viewSearchPanel: unknown value', _state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.searchType);\n    }\n    return result.join('');\n};\nconst viewInlineError = (id, message) => `\n  <p id=\"${id}\" class=\"govuk-error-message\">\n    <span class=\"govuk-visually-hidden\">Error:</span> ${message}\n  </p>\n`;\nconst viewScopeSelector = () => {\n    var _a;\n    const errors = (_a = (0,_state__WEBPACK_IMPORTED_MODULE_1__.searchState)()) === null || _a === void 0 ? void 0 : _a.errors;\n    const err = errors && errors.includes('missingWhereToSearch');\n    return `\n  <div class=\"govuk-form-group ${err ? 'govuk-form-group--error' : ''}\">\n    <fieldset\n        class=\"govuk-fieldset\"\n        ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}\n        id=\"search-scope-wrapper\"\n        ${err ? 'aria-describedby=\"scope-error\"' : ''}>\n      <legend class=\"govuk-fieldset__legend\">\n        Keyword location\n      </legend>\n      ${err ? viewInlineError('scope-error', 'Please choose at least one option') : ''}\n      <div class=\"govuk-checkboxes\" id=\"search-locations\">\n        <div class=\"govuk-checkboxes__item\">\n          <input\n              class=\"govuk-checkboxes__input\"\n              type=\"checkbox\" id=\"search-title\"\n              ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.whereToSearch.title ? 'checked' : ''}/>\n          <label for=\"search-title\" class=\"govuk-label govuk-checkboxes__label\">title</label>\n        </div>\n        <div class=\"govuk-checkboxes__item\">\n          <input\n              class=\"govuk-checkboxes__input\"\n              type=\"checkbox\"\n              id=\"search-text\"\n            ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.whereToSearch.text ? 'checked' : ''}/>\n          <label for=\"search-text\" class=\"govuk-label govuk-checkboxes__label\">\n            body content and description\n          </label>\n        </div>\n      </div>\n    </fieldset>\n  </div>\n  `;\n};\nconst viewTaxonSelector = () => `\n  <div class=\"govuk-body\">\n    <div class=\"taxon-facet\">\n      <label class=\"govuk-label label--bold\" for=\"taxon\">\n        Search for taxons\n      </label>\n      <div class=\"govuk-hint\">\n        Type the first letters of a taxon or select from the dropdown\n      </div>\n      <datalist id=\"taxonList\">\n        ${_state__WEBPACK_IMPORTED_MODULE_1__.state.taxons.map(taxon => `<option>${taxon}</option>`)}\n      </datalist>\n      <div>\n      <input\n        ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}\n        style=\"display: inline-block\"\n        list=\"taxonList\"\n        value=\"${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedTaxon}\"\n        class=\"govuk-input\"\n        id=\"taxon\"\n        autocomplete=\"off\" />\n      </div>\n    </div>\n  </div>\n`;\nconst viewLocaleSelector = () => {\n    const html = [`\n    <div class=\"govuk-body taxon-facet\">\n      <label class=\"govuk-label label--bold\" for=\"locale\">\n        Search for languages\n      </label>\n      <div class=\"govuk-hint\">\n        Type the first letters of a language or select from the dropdown\n      </div>\n      <datalist id=\"localeList\">\n  `];\n    html.push(..._state__WEBPACK_IMPORTED_MODULE_1__.state.locales.map(code => `<option data-value=\"${code}\" ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedLocale == code ? 'selected' : ''}>${(0,_lang__WEBPACK_IMPORTED_MODULE_2__.languageName)(code)}</option>`));\n    html.push(`\n      </datalist>\n      <input type=\"text\"\n         ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}\n         value=\"${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedLocale}\"\n         class=\"govuk-input\"\n         list=\"localeList\"\n         id=\"locale\" name=\"locale\"\n         autocomplete=\"off\" />\n    </div>`);\n    return html.join('');\n};\nconst viewSearchButton = () => `\n  <p class=\"govuk-body\">\n    <button\n      type=\"submit\"\n      class=\"govuk-button ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting ? 'govuk-button--disabled' : ''}\"\n      ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting ? 'disabled=\"disabled\"' : ''}\n      id=\"search\">\n      ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting ? 'Searching <img src=\"assets/images/loader.gif\" height=\"20px\" alt=\"loader\"/>' : 'Search'}\n    </button>\n  </p>\n`;\nconst viewLinkSearch = () => `\n  <div class=\"govuk-body\">\n    <label class=\"govuk-label label--bold\" for=\"link-search\">\n      Search for links\n    </label>\n    <div class=\"govuk-hint\">\n      For example: /maternity-pay-leave or youtube.com\n    </div>\n    <input\n        class=\"govuk-input\"\n        id=\"link-search\"\n        ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}\n        value=\"${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.linkSearchUrl}\"\n     />\n  </div>\n`;\nconst viewCaseSensitiveSelector = () => `\n  <div class=\"govuk-body\">\n    <div class=\"govuk-checkboxes\">\n      <div class=\"govuk-checkboxes__item\">\n        <input\n            class=\"govuk-checkboxes__input\"\n            ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}\n            type=\"checkbox\"\n            id=\"case-sensitive\"\n            ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.caseSensitive ? 'checked' : ''}\n        />\n        <label for=\"case-sensitive\" class=\"govuk-label govuk-checkboxes__label\">case-sensitive search</label>\n      </div>\n    </div>\n  </div>\n`;\nconst viewKeywordsCombinator = () => ` <div class=\"govuk-form-group\">\n    <fieldset\n        class=\"govuk-fieldset\"\n        id=\"combinator-wrapper\"\n        ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}>\n\n      <legend class=\"govuk-fieldset__legend\">\n        Search for\n      </legend>\n      <div class=\"govuk-radios\" id=\"combinators\">\n        <div class=\"govuk-radios__item\">\n          <input class=\"govuk-radios__input\"\n                 type=\"radio\" id=\"combinator-any\"\n                 name=\"combinator\"\n            ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.combinator === 'any' ? 'checked' : ''}/>\n          <label for=\"combinator-any\" class=\"govuk-label govuk-radios__label\">\n            any keyword\n          </label>\n        </div>\n        <div class=\"govuk-radios__item\">\n          <input class=\"govuk-radios__input\"\n                 type=\"radio\" id=\"combinator-all\"\n                 name=\"combinator\"\n            ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.combinator === 'all' ? 'checked' : ''}/>\n          <label for=\"combinator-all\" class=\"govuk-label govuk-radios__label\">\n            all keywords\n          </label>\n        </div>\n      </div>\n    </fieldset>\n  </div>\n`;\nconst viewPublishingAppSelector = () => ` <div class=\"govuk-form-group\">\n    <fieldset\n        class=\"govuk-fieldset\"\n        id=\"search-areas-wrapper\"\n        ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}>\n      <legend class=\"govuk-fieldset__legend\">\n        Limit search\n      </legend>\n      <div class=\"govuk-radios\" id=\"site-areas\">\n        <div class=\"govuk-radios__item\">\n          <input class=\"govuk-radios__input\"\n                 type=\"radio\" id=\"area-publisher\"\n                 name=\"area\"\n            ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.areaToSearch === 'publisher' ? 'checked' : ''}/>\n          <label for=\"area-publisher\" class=\"govuk-label govuk-radios__label\">\n            Publisher\n          </label>\n        </div>\n        <div class=\"govuk-radios__item\">\n          <input class=\"govuk-radios__input\"\n                 type=\"radio\" id=\"area-whitehall\"\n                 name=\"area\"\n            ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.areaToSearch === 'whitehall' ? 'checked' : ''}/>\n          <label for=\"area-whitehall\" class=\"govuk-label govuk-radios__label\">Whitehall</label>\n        </div>\n        <div class=\"govuk-radios__item\">\n          <input class=\"govuk-radios__input\"\n                 type=\"radio\" id=\"area-any\"\n                 name=\"area\"\n            ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.areaToSearch === 'any' ? 'checked' : ''}/>\n          <label for=\"area-any\" class=\"govuk-label govuk-radios__label\">All publishing applications</label>\n        </div>\n      </div>\n    </fieldset>\n  </div>\n`;\nconst viewKeywordsInput = () => `\n  <div class=\"govuk-body\">\n    <label for=\"keyword\" class=\"govuk-label label--bold\">Search for keywords</label>\n    <div class=\"govuk-hint\">\n      For example: cat, dog, &quot;Department for Education&quot;\n    </div>\n    <input\n      ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}\n      class=\"govuk-input\"\n      id=\"keyword\"\n      value='${(0,_utils__WEBPACK_IMPORTED_MODULE_0__.sanitiseOutput)(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedWords)}'\n    />\n  </div>\n`;\nconst viewExclusionsInput = () => `\n  <div class=\"govuk-body\">\n    <label for=\"excluded-keyword\" class=\"govuk-label label--bold\">\n      Exclude keywords\n    </label>\n    <div class=\"govuk-hint\">\n      For example: passport\n    </div>\n    <input class=\"govuk-input\"\n        ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}\n        id=\"excluded-keyword\"\n        value='${(0,_utils__WEBPACK_IMPORTED_MODULE_0__.sanitiseOutput)(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.excludedWords).replace('\"', '&quot;')}'/>\n  </div>\n`;\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/view/view-search-panel.ts?");

/***/ }),

/***/ "./src/ts/view/view.ts":
/*!*****************************!*\
  !*** ./src/ts/view/view.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"view\": () => (/* binding */ view)\n/* harmony export */ });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils */ \"./src/ts/utils.ts\");\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../state */ \"./src/ts/state.ts\");\n/* harmony import */ var _events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../events */ \"./src/ts/events.ts\");\n/* harmony import */ var _lang__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lang */ \"./src/ts/lang.ts\");\n/* harmony import */ var _view_metabox__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./view-metabox */ \"./src/ts/view/view-metabox.ts\");\n/* harmony import */ var _view_search_panel__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./view-search-panel */ \"./src/ts/view/view-search-panel.ts\");\n/* harmony import */ var _event_types__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../event-types */ \"./src/ts/event-types.ts\");\n\n\n\n\n\n\n\nconst view = () => {\n    var _a, _b, _c;\n    console.log('view');\n    document.title = 'GovGraph search';\n    const pageContent = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.id)('page-content');\n    if (pageContent) {\n        pageContent.innerHTML = `\n      <main class=\"govuk-main-wrapper\" id=\"main-content\" role=\"main\">\n        ${viewErrorBanner()}\n        ${viewSearchTypeSelector()}\n        ${viewMainLayout()}\n        <p class=\"govuk-body-s\">\n          Runs only between 9am and 7pm.\n          Searches do not include history mode content, Publisher GitHub smart answers or service domains.\n          Popularity scores depend on cookie consent.\n        </p>\n      </main>\n    `;\n    }\n    // Add event handlers\n    document.querySelectorAll('button, input[type=checkbox][data-interactive=true]')\n        .forEach(input => input.addEventListener('click', event => (0,_events__WEBPACK_IMPORTED_MODULE_2__.handleEvent)({ type: _event_types__WEBPACK_IMPORTED_MODULE_6__.EventType.Dom, id: event.target.getAttribute('id') || undefined })));\n    // Not sure this is even fired, since browser blocks submit because \"the form is not connected\"\n    (_a = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.id)('search-form')) === null || _a === void 0 ? void 0 : _a.addEventListener('submit', event => {\n        event.preventDefault();\n        // Tell GTM the form was submitted\n        window.dataLayer = window.dataLayer || [];\n        window.dataLayer.push({\n            'event': 'formSubmission',\n            'formType': 'Search',\n            'formPosition': 'Page'\n        });\n        (0,_events__WEBPACK_IMPORTED_MODULE_2__.handleEvent)({ type: _event_types__WEBPACK_IMPORTED_MODULE_6__.EventType.Dom, id: 'search' });\n    });\n    (_b = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.id)('meta-results-expand')) === null || _b === void 0 ? void 0 : _b.addEventListener('click', () => (0,_events__WEBPACK_IMPORTED_MODULE_2__.handleEvent)({ type: _event_types__WEBPACK_IMPORTED_MODULE_6__.EventType.Dom, id: 'toggleDisamBox' }));\n    // focus on the results heading if present\n    (_c = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.id)('results-heading')) === null || _c === void 0 ? void 0 : _c.focus();\n};\nconst viewSearchTypeSelector = () => `\n    <p class=\"govuk-body search-selector\">\n      Search for:\n      <button class=\"${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.searchType === 'keyword' ? 'active' : ''}\" id=\"search-keyword\">Keywords</button>\n      <button class=\"${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.searchType === 'link' ? 'active' : ''}\" id=\"search-link\">Links</button>\n      <button class=\"${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.searchType === 'taxon' ? 'active' : ''}\" id=\"search-taxon\">Taxons</button>\n      <button class=\"${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.searchType === 'language' ? 'active' : ''}\" id=\"search-language\">Languages</button>\n      <button class=\"${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.searchType === 'mixed' ? 'active' : ''}\" id=\"search-mixed\">Mixed</button>\n    </p>\n  `;\nconst viewMainLayout = () => {\n    const result = [];\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.searchType === 'mixed') {\n        if (!_state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults) {\n            result.push(`\n        <div class=\"govuk-grid-row mixed-layout--no-results\">\n          <div class=\"govuk-grid-column-two-thirds\">\n            ${(0,_view_search_panel__WEBPACK_IMPORTED_MODULE_5__.viewSearchPanel)()}\n          </div>\n        </div>\n      `);\n        }\n        else {\n            result.push(`\n        <div class=\"govuk-grid-row mixed-layout\">\n          <div class=\"govuk-grid-column-one-third\">\n            ${(0,_view_search_panel__WEBPACK_IMPORTED_MODULE_5__.viewSearchPanel)()}\n          </div>\n          <div class=\"govuk-grid-column-two-thirds\">\n            ${viewSearchResults()}\n          </div>\n        </div>\n      `);\n        }\n    }\n    else {\n        result.push(`\n      <div class=\"govuk-grid-row simple-search\">\n        <div class=\"govuk-grid-column-two-thirds\">\n          ${(0,_view_search_panel__WEBPACK_IMPORTED_MODULE_5__.viewSearchPanel)()}\n        </div>\n      </div>\n      ${viewSearchResults()}\n    `);\n    }\n    return result.join('');\n};\nconst makeBold = (text, includeMarkup) => includeMarkup ?\n    `<span class=\"govuk-!-font-weight-bold\">${text}</span>` :\n    `\"${text}\"`;\nconst viewContainDescription = (includeMarkup) => {\n    let where;\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.whereToSearch.title && _state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.whereToSearch.text) {\n        where = '';\n    }\n    else if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.whereToSearch.title) {\n        where = 'in their title';\n    }\n    else {\n        where = 'in their body content';\n    }\n    let combineOp = _state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.combinator === 'all' ? 'and' : 'or';\n    let combinedWords = (0,_utils__WEBPACK_IMPORTED_MODULE_0__.splitKeywords)(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedWords)\n        .filter(w => w.length > 2)\n        .map(w => makeBold(w, includeMarkup))\n        .join(` ${combineOp} `);\n    return _state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedWords !== '' ? `${combinedWords} ${where}` : '';\n};\nconst viewQueryDescription = (includeMarkup = true) => {\n    const clauses = [];\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedWords !== '') {\n        let keywords = `contain ${viewContainDescription(includeMarkup)}`;\n        if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.excludedWords !== '') {\n            keywords = `${keywords} (but don't contain ${makeBold(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.excludedWords, includeMarkup)})`;\n        }\n        clauses.push(keywords);\n    }\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedTaxon !== '')\n        clauses.push(`belong to the ${makeBold(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedTaxon, includeMarkup)} taxon (or its sub-taxons)`);\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedLocale !== '')\n        clauses.push(`are in ${makeBold((0,_lang__WEBPACK_IMPORTED_MODULE_3__.languageName)(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.selectedLocale), includeMarkup)}`);\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.linkSearchUrl !== '')\n        clauses.push(`link to ${makeBold(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.linkSearchUrl, includeMarkup)}`);\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.areaToSearch === 'whitehall' || _state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.areaToSearch === 'publisher')\n        clauses.push(`are published using ${makeBold(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchParams.areaToSearch, includeMarkup)}`);\n    const joinedClauses = (clauses.length === 1) ?\n        clauses[0] :\n        `${clauses.slice(0, clauses.length - 1).join(', ')} and ${clauses[clauses.length - 1]}`;\n    return `pages that ${joinedClauses}`;\n};\nconst viewErrorBanner = () => {\n    const html = [];\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.systemErrorText || _state__WEBPACK_IMPORTED_MODULE_1__.state.userErrors.length > 0) {\n        html.push(`\n        <div class=\"govuk-error-summary\" aria-labelledby=\"error-summary-title\" role=\"alert\" tabindex=\"-1\" data-module=\"govuk-error-summary\">`);\n        if (_state__WEBPACK_IMPORTED_MODULE_1__.state.systemErrorText) {\n            let errorText;\n            switch (_state__WEBPACK_IMPORTED_MODULE_1__.state.systemErrorText) {\n                case 'TIMEOUT':\n                    errorText = \"The databse took too long to respond. This is usually due to too many query results. Please try a more precise query.\";\n                    break;\n                default:\n                    errorText = \"A problem has occurred with the database.\";\n            }\n            html.push(`\n          <h1 class=\"govuk-error-summary__title\" id=\"error-summary-title\">There is a problem</h1>\n          <p class=\"govuk-body\">${errorText}</p>\n          <p>Please <a class=\\\"govuk-link\\\" href=\\\"mailto:data-products-research@digital.cabinet-office.gov.uk\\\">contact the Data Products team</a> if the problem persists.</p>\n      `);\n        }\n        else {\n            if (_state__WEBPACK_IMPORTED_MODULE_1__.state.userErrors.length > 0) {\n                html.push(`\n            <h1 class=\"govuk-error-summary__title\" id=\"error-summary-title\">\n              There is a problem\n            </h1>\n            <ul class=\"govuk-error-summary__list\">\n          `);\n                _state__WEBPACK_IMPORTED_MODULE_1__.state.userErrors.forEach(userError => {\n                    switch (userError) {\n                        case 'missingWhereToSearch':\n                            html.push(`\n              <li><a href=\"#search-locations-wrapper\">You need to select a keyword location</a></li>`);\n                            break;\n                        case 'missingArea':\n                            html.push(`\n              <li><a href=\"#search-scope-wrapper\">You need to select a publishing application</a></li>`);\n                            break;\n                        default:\n                            console.log('unknown user error code:', userError);\n                    }\n                });\n                html.push(`\n            </ul>`);\n            }\n        }\n        html.push(`\n        </div>\n      `);\n    }\n    return html.join('');\n};\nconst viewSearchResultsTable = () => {\n    var _a, _b;\n    const html = [];\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults && ((_a = _state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n        const recordsToShow = (_b = _state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults) === null || _b === void 0 ? void 0 : _b.slice(_state__WEBPACK_IMPORTED_MODULE_1__.state.skip, _state__WEBPACK_IMPORTED_MODULE_1__.state.skip + _state__WEBPACK_IMPORTED_MODULE_1__.state.resultsPerPage);\n        html.push(`\n      <div class=\"govuk-body\">\n        <fieldset class=\"govuk-fieldset\" ${_state__WEBPACK_IMPORTED_MODULE_1__.state.waiting && 'disabled=\"disabled\"'}>\n          <legend class=\"govuk-fieldset__legend\">For each result, display:</legend>\n          <ul class=\"kg-checkboxes\" id=\"show-fields\">`);\n        html.push(Object.keys(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults[0]).map(key => `\n            <li class=\"kg-checkboxes__item\">\n              <input class=\"kg-checkboxes__input\"\n                     data-interactive=\"true\"\n                     type=\"checkbox\" id=\"show-field-${key}\"\n                ${_state__WEBPACK_IMPORTED_MODULE_1__.state.showFields[key] ? 'checked' : ''}/>\n              <label for=\"show-field-${key}\" class=\"kg-label kg-checkboxes__label\">${fieldName(key)}</label>\n            </li>`).join(''));\n        html.push(`\n          </ul>\n        </fieldset>\n        <table id=\"results-table\" class=\"govuk-table\">\n          <tbody class=\"govuk-table__body\">\n          <tr class=\"govuk-table__row\">\n            <th scope=\"col\" class=\"a11y-hidden\">Page</th>`);\n        Object.keys(_state__WEBPACK_IMPORTED_MODULE_1__.state.showFields).forEach(key => {\n            if (_state__WEBPACK_IMPORTED_MODULE_1__.state.showFields[key]) {\n                html.push(`<th scope=\"col\" class=\"govuk-table__header\">${fieldName(key)}</th>`);\n            }\n        });\n        recordsToShow.forEach((record, recordIndex) => {\n            html.push(`\n        <tr class=\"govuk-table__row\">\n          <th class=\"a11y-hidden\">${recordIndex}</th>`);\n            Object.keys(_state__WEBPACK_IMPORTED_MODULE_1__.state.showFields).forEach(key => {\n                if (_state__WEBPACK_IMPORTED_MODULE_1__.state.showFields[key]) {\n                    html.push(`<td class=\"govuk-table__cell\">${fieldFormat(key, record[key])}</td>`);\n                }\n            });\n            html.push(`</tr>`);\n        });\n        html.push(`\n          </tbody>\n        </table>\n      </div>`);\n        return html.join('');\n    }\n    else {\n        return '';\n    }\n};\nconst csvFromResults = function (searchResults) {\n    const csv = [];\n    if (searchResults && searchResults.length > 0) {\n        // column headings: take them from the first record\n        csv.push(Object.keys(searchResults[0]).map(fieldName).join());\n        // rows:\n        searchResults.forEach((record) => {\n            const line = [];\n            Object.values(record).forEach((field) => {\n                if (field) {\n                    field = field.toString();\n                    if (field.includes(',')) {\n                        field = `\"${field.replace('\"', '\"\"')}\"`;\n                    }\n                    else {\n                        if (field.includes('\"')) {\n                            field = '\"' + field.replace('\"', '\"\"') + '\"';\n                        }\n                    }\n                }\n                else {\n                    field = '';\n                }\n                line.push(field);\n            });\n            csv.push(line.join());\n        });\n    }\n    return csv.join('\\n');\n};\nconst viewWaiting = () => `\n  <div class=\"govuk-body\">Searching for ${viewQueryDescription()}</div>\n  <p class=\"govuk-body-s\">Some queries may take up to a minute</p>\n`;\nconst viewResults = function () {\n    if (_state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults) {\n        const html = [];\n        const nbRecords = _state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults.length;\n        if (nbRecords < 50000) {\n            html.push(`\n        <h1 tabindex=\"0\" id=\"results-heading\" class=\"govuk-heading-l\">${nbRecords} result${nbRecords !== 0 ? 's' : ''}</h1>`);\n        }\n        else {\n            html.push(`\n        <div class=\"govuk-warning-text\">\n          <span class=\"govuk-warning-text__icon\" aria-hidden=\"true\">!</span>\n          <strong class=\"govuk-warning-text__text\">\n            <span class=\"govuk-warning-text__assistive\">Warning</span>\n            There are more than 50000 results. Try to narrow down your search.\n          </strong>\n        </div>\n      `);\n        }\n        html.push(`<div class=\"govuk-body\">for ${viewQueryDescription()}</div>`);\n        if (nbRecords > _state__WEBPACK_IMPORTED_MODULE_1__.state.resultsPerPage) {\n            html.push(`\n        <p class=\"govuk-body\">Showing results ${_state__WEBPACK_IMPORTED_MODULE_1__.state.skip + 1} to ${Math.min(nbRecords, _state__WEBPACK_IMPORTED_MODULE_1__.state.skip + _state__WEBPACK_IMPORTED_MODULE_1__.state.resultsPerPage)}, in descending popularity</p>\n        <a class=\"govuk-skip-link\" href=\"#results-table\">Skip to results</a>\n        <a class=\"govuk-skip-link\" href=\"#search-form\">Back to search filters</a>\n     `);\n        }\n        html.push(viewSearchResultsTable());\n        html.push(`\n      <p class=\"govuk-body\">\n        <button type=\"button\" class=\"govuk-button\" id=\"button-prev-page\" ${_state__WEBPACK_IMPORTED_MODULE_1__.state.skip < _state__WEBPACK_IMPORTED_MODULE_1__.state.resultsPerPage ? \"disabled\" : \"\"}>Previous</button>\n        <button type=\"button\" class=\"govuk-button\" id=\"button-next-page\" ${_state__WEBPACK_IMPORTED_MODULE_1__.state.skip + _state__WEBPACK_IMPORTED_MODULE_1__.state.resultsPerPage >= nbRecords ? \"disabled\" : \"\"}>Next</button>\n      </p>`);\n        const csv = csvFromResults(_state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults);\n        const file = new Blob([csv], { type: 'text/csv' });\n        const url = URL.createObjectURL(file); // TODO: use window.URL.revokeObjectURL(url);  after\n        html.push(`\n      <p class=\"govuk-body\"><a class=\"govuk-link\" href=\"${url}\" download=\"export.csv\">Download all ${_state__WEBPACK_IMPORTED_MODULE_1__.state.searchResults.length} records in CSV</a></p>`);\n        return html.join('');\n    }\n    else {\n        return '';\n    }\n};\nconst viewNoResults = () => {\n    return `\n    <h1 tabindex=\"0\" id=\"results-heading\" class=\"govuk-heading-l\">No results</h1>\n    <div class=\"govuk-body\">for ${viewQueryDescription()} </div>\n  `;\n};\nconst viewSearchResults = () => {\n    switch ((0,_state__WEBPACK_IMPORTED_MODULE_1__.searchState)().code) {\n        case 'waiting':\n            document.title = `GOV.UK ${viewQueryDescription(false)} - GovGraph search`;\n            return viewWaiting();\n        case 'results':\n            document.title = `GOV.UK ${viewQueryDescription(false)} - GovGraph search`;\n            return `${(0,_view_metabox__WEBPACK_IMPORTED_MODULE_4__.viewMetaResults)() || ''} ${viewResults()}`; // FIXME - avoid || ''\n        case 'no-results':\n            document.title = `GOV.UK ${viewQueryDescription(false)} - GovGraph search`;\n            return `${(0,_view_metabox__WEBPACK_IMPORTED_MODULE_4__.viewMetaResults)() || ''} ${viewNoResults()}`; // FIXME - avoid || ''\n        default:\n            document.title = 'GovGraph search';\n            return '';\n    }\n};\n// Remove duplicates - but should be fixed in cypher\nconst formatNames = (array) => [...new Set(array)].map(x => `\"${x}\"`).join(', ');\nconst formatDateTime = (date) => `${date.value.slice(0, 10)} at ${date.value.slice(11, 16)}`;\nconst fieldFormatters = {\n    'url': {\n        name: 'URL',\n        format: (url) => `<a class=\"govuk-link\" href=\"${url}\">${url}</a>`\n    },\n    'title': { name: 'Title' },\n    'locale': { name: 'Language', format: _lang__WEBPACK_IMPORTED_MODULE_3__.languageName },\n    'documentType': { name: 'Document type' },\n    'publishing_app': { name: 'Publishing app' },\n    'first_published_at': {\n        name: 'First published',\n        format: formatDateTime\n    },\n    'public_updated_at': {\n        name: 'Last major update',\n        format: formatDateTime,\n    },\n    'taxons': {\n        name: 'Taxons',\n        format: formatNames\n    },\n    'primary_organisation': {\n        name: 'Primary publishing organisation',\n        format: (x) => {\n            console.log(101, x);\n            return x;\n        }\n    },\n    'all_organisations': {\n        name: 'All publishing organisations',\n        format: formatNames\n    },\n    'pagerank': {\n        name: 'Popularity',\n        format: (val) => val ? parseFloat(val).toFixed(2) : 'n/a'\n    },\n    'withdrawn_at': {\n        name: 'Withdrawn at',\n        format: (date) => date ? formatDateTime(date) : \"not withdrawn\"\n    },\n    'withdrawn_explanation': {\n        name: 'Withdrawn reason',\n        format: (text) => text || 'n/a'\n    }\n};\nconst fieldName = function (key) {\n    const f = fieldFormatters[key];\n    return f ? f.name : key;\n};\nconst fieldFormat = function (key, val) {\n    const f = fieldFormatters[key];\n    return (f && f.format) ? f.format(val) : val;\n};\n\n\n\n//# sourceURL=webpack://knowledge-graph-search/./src/ts/view/view.ts?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/ts/main.ts");
/******/ 	
/******/ })()
;